<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="  Quick R Tutorial" />
<meta property="og:type" content="book" />


<meta property="og:description" content="This book covers the essentials of using R." />


<meta name="author" content="Frank Erickson" />

<meta name="date" content="2017-03-27" />


<meta name="description" content="This book covers the essentials of using R.">

<title>  Quick R Tutorial</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a><ul>
<li><a href="index.html#getting-started-with-r"><span class="toc-section-number">1.1</span> Getting started with R</a></li>
<li><a href="index.html#reading-this-book"><span class="toc-section-number">1.2</span> Reading this book</a></li>
<li><a href="index.html#about-this-book"><span class="toc-section-number">1.3</span> About this book</a></li>
</ul></li>
<li class="has-sub"><a href="basics.html#basics"><span class="toc-section-number">2</span> Basics</a><ul>
<li class="has-sub"><a href="basics.html#vectors"><span class="toc-section-number">2.1</span> Vectors</a><ul>
<li><a href="basics.html#documentation"><span class="toc-section-number">2.1.1</span> Documentation</a></li>
<li><a href="basics.html#classes"><span class="toc-section-number">2.1.2</span> Classes</a></li>
<li><a href="basics.html#making-comparisons"><span class="toc-section-number">2.1.3</span> Making comparisons</a></li>
<li><a href="basics.html#str"><span class="toc-section-number">2.1.4</span> Inspecting objects</a></li>
<li><a href="basics.html#names"><span class="toc-section-number">2.1.5</span> Named elements</a></li>
<li><a href="basics.html#na"><span class="toc-section-number">2.1.6</span> Missing values</a></li>
<li><a href="basics.html#slicing"><span class="toc-section-number">2.1.7</span> Slicing to a subvector</a></li>
<li><a href="basics.html#extract-list"><span class="toc-section-number">2.1.8</span> Extracting from a list</a></li>
<li><a href="basics.html#subassigning"><span class="toc-section-number">2.1.9</span> Assigning to a subvector</a></li>
<li><a href="basics.html#assigning-to-a-list-element"><span class="toc-section-number">2.1.10</span> Assigning to a list element</a></li>
<li><a href="basics.html#initializing"><span class="toc-section-number">2.1.11</span> Initializing</a></li>
<li><a href="basics.html#factors"><span class="toc-section-number">2.1.12</span> Factors</a></li>
<li><a href="basics.html#sort-rank-order"><span class="toc-section-number">2.1.13</span> Sorting, rank, order</a></li>
<li><a href="basics.html#testing-membership"><span class="toc-section-number">2.1.14</span> Testing membership</a></li>
<li><a href="basics.html#exercises"><span class="toc-section-number">2.1.15</span> Exercises</a></li>
</ul></li>
<li class="has-sub"><a href="basics.html#matrix-array"><span class="toc-section-number">2.2</span> Matrices and arrays</a><ul>
<li><a href="basics.html#building-matrices"><span class="toc-section-number">2.2.1</span> Building matrices</a></li>
<li><a href="basics.html#named-rows-and-columns"><span class="toc-section-number">2.2.2</span> Named rows and columns</a></li>
<li><a href="basics.html#slicing-matrix"><span class="toc-section-number">2.2.3</span> Slicing to a submatrix</a></li>
<li><a href="basics.html#matrix-extract"><span class="toc-section-number">2.2.4</span> Extracting from matrices</a></li>
<li><a href="basics.html#subassigning-to-matrices"><span class="toc-section-number">2.2.5</span> Subassigning to matrices</a></li>
<li><a href="basics.html#arrays"><span class="toc-section-number">2.2.6</span> Arrays</a></li>
</ul></li>
<li class="has-sub"><a href="basics.html#syntax"><span class="toc-section-number">2.3</span> Syntax</a><ul>
<li><a href="basics.html#assigning-to-attributes"><span class="toc-section-number">2.3.1</span> Assigning to attributes</a></li>
<li><a href="basics.html#arithmetic"><span class="toc-section-number">2.3.2</span> Arithmetic</a></li>
<li><a href="basics.html#logical-operators"><span class="toc-section-number">2.3.3</span> Logical operators</a></li>
<li><a href="basics.html#matrix-algebra"><span class="toc-section-number">2.3.4</span> Matrix algebra</a></li>
<li><a href="basics.html#order-ops"><span class="toc-section-number">2.3.5</span> Order of operations</a></li>
<li><a href="basics.html#vectorization"><span class="toc-section-number">2.3.6</span> Elementwise operations</a></li>
</ul></li>
<li class="has-sub"><a href="basics.html#functions"><span class="toc-section-number">2.4</span> Functions</a><ul>
<li><a href="basics.html#community-made-functions"><span class="toc-section-number">2.4.1</span> Community-made functions</a></li>
<li><a href="basics.html#passing-arguments"><span class="toc-section-number">2.4.2</span> Passing arguments</a></li>
<li><a href="basics.html#lapply"><span class="toc-section-number">2.4.3</span> Iterating over a list</a></li>
<li><a href="basics.html#function-writing"><span class="toc-section-number">2.4.4</span> Writing functions</a></li>
<li><a href="basics.html#scoping"><span class="toc-section-number">2.4.5</span> Scoping</a></li>
<li><a href="basics.html#lazy"><span class="toc-section-number">2.4.6</span> Lazy evaluation</a></li>
<li><a href="basics.html#function-environment"><span class="toc-section-number">2.4.7</span> Environment</a></li>
<li><a href="basics.html#default-args"><span class="toc-section-number">2.4.8</span> Default arguments</a></li>
<li><a href="basics.html#finding-a-function-by-name"><span class="toc-section-number">2.4.9</span> Finding a function by name</a></li>
<li><a href="basics.html#inspect-fns"><span class="toc-section-number">2.4.10</span> Inspecting function source code</a></li>
</ul></li>
<li class="has-sub"><a href="basics.html#loops"><span class="toc-section-number">2.5</span> Loops and control flow</a><ul>
<li><a href="basics.html#for-loops"><span class="toc-section-number">2.5.1</span> Thinking about <code>for</code> loops</a></li>
<li><a href="basics.html#ifelse"><span class="toc-section-number">2.5.2</span> <code>if</code>/<code>else</code> elementwise</a></li>
</ul></li>
<li class="has-sub"><a href="basics.html#data-frames"><span class="toc-section-number">2.6</span> Data frames</a><ul>
<li><a href="basics.html#lapply-df"><span class="toc-section-number">2.6.1</span> Iterating over columns</a></li>
<li><a href="basics.html#view"><span class="toc-section-number">2.6.2</span> Inspection</a></li>
</ul></li>
<li><a href="basics.html#built-ins"><span class="toc-section-number">2.7</span> Built-in constants</a></li>
</ul></li>
<li class="has-sub"><a href="tables.html#tables"><span class="toc-section-number">3</span> Tables</a><ul>
<li class="has-sub"><a href="tables.html#essential-packages"><span class="toc-section-number">3.1</span> Essential packages</a><ul>
<li><a href="tables.html#magrittr"><span class="toc-section-number">3.1.1</span> The magrittr package</a></li>
<li><a href="tables.html#data-table"><span class="toc-section-number">3.1.2</span> The data.table package</a></li>
</ul></li>
<li class="has-sub"><a href="tables.html#dt-class"><span class="toc-section-number">3.2</span> The data.table class</a><ul>
<li><a href="tables.html#dt-inspect"><span class="toc-section-number">3.2.1</span> Inspecting</a></li>
<li><a href="tables.html#dt-slicing"><span class="toc-section-number">3.2.2</span> Slicing</a></li>
<li><a href="tables.html#extracting-columns"><span class="toc-section-number">3.2.3</span> Extracting columns</a></li>
<li><a href="tables.html#extensions-to-the-data.frame-class"><span class="toc-section-number">3.2.4</span> Extensions to the data.frame class</a></li>
</ul></li>
<li class="has-sub"><a href="tables.html#dt-agg"><span class="toc-section-number">3.3</span> Aggregation</a><ul>
<li><a href="tables.html#dt-lapply"><span class="toc-section-number">3.3.1</span> Iterating over columns</a></li>
</ul></li>
<li class="has-sub"><a href="tables.html#dt-subassign"><span class="toc-section-number">3.4</span> Modifying data</a><ul>
<li><a href="tables.html#dt-col-create"><span class="toc-section-number">3.4.1</span> Creating columns</a></li>
<li><a href="tables.html#removing-columns"><span class="toc-section-number">3.4.2</span> Removing columns</a></li>
<li><a href="tables.html#dt-replace-all"><span class="toc-section-number">3.4.3</span> Replacing entire columns</a></li>
<li><a href="tables.html#dt-ifelse"><span class="toc-section-number">3.4.4</span> Replacing columns conditionally</a></li>
<li><a href="tables.html#other-in-place-modifications"><span class="toc-section-number">3.4.5</span> Other in-place modifications</a></li>
<li><a href="tables.html#avoiding-in-place-modification"><span class="toc-section-number">3.4.6</span> Avoiding in-place modification</a></li>
<li><a href="tables.html#using-in-place-modification-in-functions"><span class="toc-section-number">3.4.7</span> Using in-place modification in functions</a></li>
</ul></li>
<li class="has-sub"><a href="tables.html#dt-joins"><span class="toc-section-number">3.5</span> Joins</a><ul>
<li><a href="tables.html#equi-joins"><span class="toc-section-number">3.5.1</span> Equi joins</a></li>
<li><a href="tables.html#subset-lookup"><span class="toc-section-number">3.5.2</span> Subset lookup</a></li>
<li><a href="tables.html#aggregating-in-a-join"><span class="toc-section-number">3.5.3</span> Aggregating in a join</a></li>
<li><a href="tables.html#joins-update"><span class="toc-section-number">3.5.4</span> Updating in a join</a></li>
<li><a href="tables.html#self-join-to-fill-in-missing-levels"><span class="toc-section-number">3.5.5</span> Self join to fill in missing levels</a></li>
<li><a href="tables.html#join-matches"><span class="toc-section-number">3.5.6</span> Handling matches</a></li>
<li><a href="tables.html#joins-nonequi"><span class="toc-section-number">3.5.7</span> Non-equi joins</a></li>
<li><a href="tables.html#shortcuts-and-tricks"><span class="toc-section-number">3.5.8</span> Shortcuts and tricks</a></li>
</ul></li>
<li class="has-sub"><a href="tables.html#input-output"><span class="toc-section-number">3.6</span> Input and output</a><ul>
<li><a href="tables.html#file-paths"><span class="toc-section-number">3.6.1</span> File paths</a></li>
<li><a href="tables.html#fread"><span class="toc-section-number">3.6.2</span> <code>fread</code> to read delimited files</a></li>
<li><a href="tables.html#rbindlist-read"><span class="toc-section-number">3.6.3</span> <code>rbindlist</code> to combine tables</a></li>
<li><a href="tables.html#dates-times"><span class="toc-section-number">3.6.4</span> Date and time columns</a></li>
<li><a href="tables.html#character-columns"><span class="toc-section-number">3.6.5</span> Character columns</a></li>
<li><a href="tables.html#dt-recode"><span class="toc-section-number">3.6.6</span> Categorical columns</a></li>
<li><a href="tables.html#list-columns"><span class="toc-section-number">3.6.7</span> List columns</a></li>
<li><a href="tables.html#fwrite"><span class="toc-section-number">3.6.8</span> <code>fwrite</code> to write delimited files</a></li>
<li><a href="tables.html#dt-saveload"><span class="toc-section-number">3.6.9</span> Saving and loading R objects</a></li>
<li><a href="tables.html#reading-and-writing-other-formats"><span class="toc-section-number">3.6.10</span> Reading and writing other formats</a></li>
<li><a href="tables.html#formatting-the-display-of-columns"><span class="toc-section-number">3.6.11</span> Formatting the display of columns</a></li>
</ul></li>
<li class="has-sub"><a href="tables.html#exploring-data"><span class="toc-section-number">3.7</span> Exploring data</a><ul>
<li><a href="tables.html#browse-env"><span class="toc-section-number">3.7.1</span> Browsing loaded objects</a></li>
<li><a href="tables.html#dt-subset"><span class="toc-section-number">3.7.2</span> Subsetting</a></li>
<li><a href="tables.html#sorting"><span class="toc-section-number">3.7.3</span> Sorting</a></li>
<li><a href="tables.html#explore-onevar"><span class="toc-section-number">3.7.4</span> Examining each variable</a></li>
<li><a href="tables.html#explore-vars"><span class="toc-section-number">3.7.5</span> Examining variables jointly</a></li>
<li><a href="tables.html#dcast-browse"><span class="toc-section-number">3.7.6</span> Reshaping to wide</a></li>
</ul></li>
<li class="has-sub"><a href="tables.html#structuring-data"><span class="toc-section-number">3.8</span> Organizing relational tables</a><ul>
<li><a href="tables.html#redundant"><span class="toc-section-number">3.8.1</span> Removing redundant data</a></li>
<li><a href="tables.html#melt"><span class="toc-section-number">3.8.2</span> Reshaping to long</a></li>
<li><a href="tables.html#relational-updatejoin"><span class="toc-section-number">3.8.3</span> Preparing data with update joins</a></li>
<li><a href="tables.html#program-tables"><span class="toc-section-number">3.8.4</span> Programming with tables</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="work.html#work"><span class="toc-section-number">4</span> Getting work done</a><ul>
<li><a href="work.html#sets-and-combinations"><span class="toc-section-number">4.1</span> Sets and combinations</a></li>
<li class="has-sub"><a href="work.html#randomization"><span class="toc-section-number">4.2</span> Randomization</a><ul>
<li><a href="work.html#distribution-draws"><span class="toc-section-number">4.2.1</span> Distribution draws</a></li>
<li><a href="work.html#urn-draws"><span class="toc-section-number">4.2.2</span> Urn draws</a></li>
<li><a href="work.html#permutations"><span class="toc-section-number">4.2.3</span> Permutations</a></li>
<li><a href="work.html#simulations"><span class="toc-section-number">4.2.4</span> Simulations</a></li>
</ul></li>
<li class="has-sub"><a href="work.html#sequences"><span class="toc-section-number">4.3</span> Working with sequences</a><ul>
<li><a href="work.html#lag"><span class="toc-section-number">4.3.1</span> Lag operators</a></li>
<li><a href="work.html#taking-differences"><span class="toc-section-number">4.3.2</span> Taking differences</a></li>
<li><a href="work.html#rolling-computations"><span class="toc-section-number">4.3.3</span> Rolling computations</a></li>
<li><a href="work.html#run-length-encoding"><span class="toc-section-number">4.3.4</span> Run-length encoding</a></li>
<li><a href="work.html#grouping-on-runs"><span class="toc-section-number">4.3.5</span> Grouping on runs</a></li>
</ul></li>
<li><a href="work.html#combining-table-columns"><span class="toc-section-number">4.4</span> Combining table columns</a></li>
<li class="has-sub"><a href="work.html#reg"><span class="toc-section-number">4.5</span> Regression</a><ul>
<li><a href="work.html#extracting-results"><span class="toc-section-number">4.5.1</span> Extracting results</a></li>
</ul></li>
<li><a href="work.html#optimization"><span class="toc-section-number">4.6</span> Optimization</a></li>
<li><a href="work.html#integration"><span class="toc-section-number">4.7</span> Integration</a></li>
<li><a href="work.html#strings"><span class="toc-section-number">4.8</span> String operations</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="basics" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Basics</h1>
<p>This chapter covers R’s core data structures and syntax.</p>
<div id="vectors" class="section level2">
<h2><span class="header-section-number">2.1</span> Vectors</h2>
<p>In R, all data come in vectors. If we enter <code>x = 54.7</code>, then <code>x</code> will be a numeric vector of length 1. Similarly, <code>y = c(&quot;Yah&quot;, &quot;Bada bing&quot;)</code> is a character vector of length 2. Type a vector’s name to see it, and use <code>length</code> and <code>class</code> to see those attributes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># example data</span>
x =<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x</code></pre></div>
<pre><code># [1]  TRUE FALSE  TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(x)</code></pre></div>
<pre><code># [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(x)</code></pre></div>
<pre><code># [1] &quot;logical&quot;</code></pre>
<p>The bracketed <code>[1]</code> indicates that we are seeing the first element of a vector. This printing pattern is handy with vectors too long for a single line, like <code>c(LETTERS, letters)</code>.</p>
<p>Assign with <code>=</code> or <code>&lt;-</code>. Or even like <code>c(2,3) -&gt; z</code>, though this is rare and hard to read in my opinion. If an existing vector is overwritten, no warning is given.</p>
<p>caution – indexing starting from 1, for those coming from 0-indexed langs, treatment of negative indices in slicing will also be a surprise (ref it)</p>
<div id="documentation" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Documentation</h3>
<p>Everything is documented in convenient wikified html pages, accessible with <code>?</code> or <code>help</code>. For example, <code>?TRUE</code>, <code>?LETTERS</code> or <code>?length</code>. Backticks are sometimes required, as for <code>?`for`</code> and <code>?`?`</code>. Keep a close eye on the Description and Value sections, which concisely explain what to expect from a function.</p>
<p>The Examples section always usefully illustrates functionality; it can be run in the console like <code>example(&quot;LETTERS&quot;)</code>. Additional illustrations are available using <code>demo</code>; type <code>demo()</code> for a listing.</p>
<p>Try typing <code>help.start()</code>. This will show a page of links to documents including “An Introduction to R”, “The R language definition” and the “R FAQ” (under “Resources”). These are essential reference documents on R, also <a href="https://cran.r-project.org/manuals.html">available in pdf online</a>.</p>
<p>R doesn’t do error codes, only error messages and warnings. If confused by a message, a search online or a review of the relevant docs is usually sufficient.</p>
</div>
<div id="classes" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Classes</h3>
<p>Every vanilla vector has a class. That is, every element of the vector contains the same type of data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="dv">4</span>, <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</code></pre></div>
<pre><code># [1] &quot;4&quot; &quot;A&quot; &quot;B&quot;</code></pre>

<div class="rmd-caution">
<strong>Coercion.</strong> The <code>4</code> is “coerced” to <code>character</code> above, with no warning. Since coercion is so central to R and confusing for new users, I strongly suggest reading its documentation, in the Details section of <code>?c</code>.
</div>
<p></p>
<p>The doc at <code>?c</code> also conveniently lists all of the vanilla (“atomic”) classes. The key ones are</p>
<ul>
<li><em>Logical</em>. Use <code>TRUE</code> or <code>FALSE</code>.</li>
<li><em>Integer</em>. Write <code>L</code> at the end: <code>1L</code>, <code>2L</code>, etc. The <code>L</code> will not be displayed in output.</li>
<li><em>Numeric</em>. Write it as usual or with <code>e</code> notation, <code>2</code>, <code>3.4</code>, <code>3e5</code>.</li>
<li><em>Character</em>. Use single or double quotes, <code>&quot;bah&quot;</code>, <code>'I say &quot;gah&quot;'</code>, etc.</li>
</ul>
<p>A <code>list</code> is a special type of vector whose elements can be arbitrary objects, for example, a list of vectors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># example data</span>
L  =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;A&quot;</span>, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
L2 =<span class="st"> </span><span class="kw">list</span>(<span class="ot">FALSE</span>)
L3 =<span class="st"> </span><span class="kw">c</span>(L, L2)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">L3</code></pre></div>
<pre><code># [[1]]
# [1] &quot;A&quot;
# 
# [[2]]
# [1] 1 2
# 
# [[3]]
# [1] FALSE</code></pre>
<p>The <code>[[1]]</code> printed here indicates the first element of the list, similar to the <code>[1]</code> we see for atomic vectors.</p>

<div class="rmd-details">
<strong>Fancier classes</strong> are generally built on top of atomic classes or lists. Behind the scenes, date formats are numeric or integer; while complex objects like data sets and regression results are lists. For details on storage modes, see <code>?typeof</code> and the <a href="https://cran.r-project.org/doc/manuals/r-release/R-ints.html">R internals</a> documentation. While some fancy data structures like linked lists and unordered sets are absent in base R, they can be used through packages like Rcpp.
</div>
<p></p>
<p>For lists, in addition to a <code>length</code>, we also have <code>lengths</code>, measuring each element:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lengths</span>(L3)</code></pre></div>
<pre><code># [1] 1 2 1</code></pre>
<p>The class of an object can be tested with <code>is.logical</code>, etc.</p>
</div>
<div id="making-comparisons" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Making comparisons</h3>
<p>To compare two objects, use <code>==</code> and <code>!=</code>. R will silently coerce the objects’ classes to match:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">&quot;4.11&quot;</span> ==<span class="st"> </span><span class="fl">4.11</span></code></pre></div>
<pre><code># [1] TRUE</code></pre>
<p>In addition, there are the usual inequality operators (<code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>), which also apply to strings, using lexicographic ordering:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">&quot;A&quot;</span> &gt;=<span class="st"> &quot;B&quot;</span></code></pre></div>
<pre><code># [1] FALSE</code></pre>
</div>
<div id="str" class="section level3">
<h3><span class="header-section-number">2.1.4</span> Inspecting objects</h3>
<p>For complicated objects, like <code>L3</code> above, <code>class(L3)</code> is not very informative. Examining the “structure” of the object is usually more useful:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(L3)</code></pre></div>
<pre><code># List of 3
#  $ : chr &quot;A&quot;
#  $ : num [1:2] 1 2
#  $ : logi FALSE</code></pre>
<p>To explore the set of loaded objects, see the tools in <a href="tables.html#browse-env">3.7.1</a>.</p>
</div>
<div id="names" class="section level3">
<h3><span class="header-section-number">2.1.5</span> Named elements</h3>
<p>A vector’s elements can be named:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code># a b 
# 1 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">list</span>(<span class="dt">A =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">B =</span> <span class="dv">4</span>)</code></pre></div>
<pre><code># $A
# [1] 1 2
# 
# $B
# [1] 4</code></pre>
<p>The names of an objects’ elements can be accessed with the <code>names</code> function.</p>

<div class="rmd-caution">
<strong>Passing arguments.</strong> Inside <code>c(A = 1)</code>, the equals sign is not interchangeable with the <code>&lt;-</code>, so don’t write <code>c(A &lt;- 1)</code>. Think of <code>c</code> as a function with syntax like <code>c(argname = argvalue, argname2 = argvalue2, ...)</code>. The equals sign has the special role of giving names to the function’s arguments. See <a href="basics.html#passing-arguments">2.4.2</a> for details.
</div>
<p></p>
<p>To assign names programmatically…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nms =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>)
<span class="kw">c</span>(nms[<span class="dv">1</span>] =<span class="st"> </span><span class="dv">1</span>, nms[<span class="dv">2</span>] =<span class="st"> </span><span class="dv">2</span>) <span class="co"># error</span></code></pre></div>
<pre><code># Error: &lt;text&gt;:2:10: unexpected &#39;=&#39;
# 1: nms = c(&quot;a&quot;, &quot;b&quot;)
# 2: c(nms[1] =
#             ^</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), nms)    <span class="co"># use this instead</span></code></pre></div>
<pre><code># a b 
# 1 2</code></pre>
</div>
<div id="na" class="section level3">
<h3><span class="header-section-number">2.1.6</span> Missing values</h3>
<p>R differs from other programming languages in its careful treatment of missing values in the reading and processing of data. The missing-data code <code>NA</code> is distinct from other special codes:</p>
<ul>
<li>a non-number, <code>NaN</code>;</li>
<li>positive and negative infinity, <code>Inf</code> and <code>-Inf</code>; and</li>
<li>the absence of an object, <code>NULL</code>.</li>
</ul>
<p>A missing value means “there is a value here, but we don’t know what it is.” So a comparison against a missing value, like <code>2 == NA</code> or <code>2 != NA</code>, will always return <code>NA</code>, since we cannot determine whether the condition is true or false. To test whether a value is missing, use the <code>is.na</code> function.</p>

<div class="rmd-details">
<strong>Implementation of missing values.</strong> The class of an <code>NA</code> is different depending on the vector it is in. Sometimes, it is important to ensure that a missing value belongs to a particular class. To ensure this, the safest approach is to “slice” an object of that class with <code>NA_integer_</code>. For example, to get a missing numeric value, we can use the number <code>10</code> like <code>10[NA_integer_]</code>; or for a date value, we can use the current date, <code>Sys.Date()</code>, like <code>Sys.Date()[NA_integer_]</code>.
</div>
<p></p>
</div>
<div id="slicing" class="section level3">
<h3><span class="header-section-number">2.1.7</span> Slicing to a subvector</h3>
<p>Select a subvector of <code>x</code> like <code>x[i]</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># example data</span>
x =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)
L =<span class="st"> </span><span class="kw">list</span>(<span class="dt">X =</span> <span class="dv">1</span>, <span class="dt">Y =</span> <span class="dv">2</span>, <span class="dt">Z =</span> <span class="dv">3</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)]</code></pre></div>
<pre><code># [1] &quot;a&quot; &quot;c&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x[-<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)]</code></pre></div>
<pre><code># [1] &quot;a&quot; &quot;d&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">L[<span class="kw">c</span>(<span class="st">&quot;Y&quot;</span>,<span class="st">&quot;Z&quot;</span>)]</code></pre></div>
<pre><code># $Y
# [1] 2
# 
# $Z
# [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x[<span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>)]</code></pre></div>
<pre><code># [1] &quot;b&quot; &quot;c&quot;</code></pre>
<p>So, the index <code>i</code> can be…</p>
<ul>
<li>a vector of positions to include;</li>
<li>a negated vector of positions to exclude;</li>
<li>a vector of element names; or</li>
<li>a true/false vector, with a selection rule for each position.</li>
</ul>
<p><code>i</code> can even contain repeated elements, like <code>x[c(1,1,2)]</code>, which is some more general “slice” of <code>x</code>, not really a subvector.</p>

<div class="rmd-caution">
<strong>Recycling.</strong> What would be the natural behavior of <code>x[TRUE]</code> in the example above? Well, in R, it acts like <code>x[c(TRUE, TRUE, TRUE, TRUE)]</code>, without giving any warning. This is called recycling – the argument <code>i</code> is repeated until it is long enough for the context is used in. What about <code>x[c(TRUE, FALSE)]</code>? The full rules for recycling can be found in the <a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.html#The-recycling-rule">R intro doc</a>.
</div>
<p></p>

<div class="rmd-details">
<strong>Special slices.</strong> There are a few edge cases worth noting. As mentioned in <a href="basics.html#na">2.1.6</a>, it can be useful to set <code>i</code> as <code>NA_integer_</code> to find the “missing value version of <code>x</code>.” Similarly, we can set <code>i</code> to <code>0L</code> to find the “empty version of <code>x</code>.” Setting <code>i</code> to include positions or names outside of range will just yield missing values and is typically not useful.
</div>
<p></p>
<p>Convenience functions <code>head</code> and <code>tail</code> enable easy slicing from the start or end of a vector.</p>
<p>… also mention blank slice</p>
</div>
<div id="extract-list" class="section level3">
<h3><span class="header-section-number">2.1.8</span> Extracting from a list</h3>
<p>Grab a single element of a vector like <code>x[[i]]</code>, where <code>i</code> is a single name or number:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># example data</span>
L =<span class="st"> </span><span class="kw">list</span>(<span class="dt">X =</span> <span class="dv">1</span>, <span class="dt">Y =</span> <span class="dv">2</span>, <span class="dt">Z =</span> <span class="dv">3</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">L[<span class="st">&quot;Z&quot;</span>] <span class="co"># slicing</span></code></pre></div>
<pre><code># $Z
# [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">L[[<span class="st">&quot;Z&quot;</span>]] <span class="co"># extracting</span></code></pre></div>
<pre><code># [1] 3</code></pre>
<p>The slice <code>L[&quot;Z&quot;]</code> is a list containing just one element; while <code>L[[&quot;Z&quot;]]</code> <em>actually is the element</em>.</p>
<p><code>L$Z</code> offers a handy alternative way of extracting by name from a list, but it is tougher to write a program around.</p>
</div>
<div id="subassigning" class="section level3">
<h3><span class="header-section-number">2.1.9</span> Assigning to a subvector</h3>
<p>Assign to a subvector, or “subassign,” like <code>x[i] = y</code> or <code>x[i] &lt;- y</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># example data</span>
x =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)
L =<span class="st"> </span><span class="kw">list</span>(<span class="dt">X =</span> <span class="dv">1</span>, <span class="dt">Y =</span> <span class="dv">2</span>, <span class="dt">Z =</span> <span class="dv">3</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;bada&quot;</span>, <span class="st">&quot;bing&quot;</span>)
L[<span class="kw">c</span>(<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;Z&quot;</span>)] =<span class="st"> </span><span class="kw">list</span>(<span class="dv">21</span>, <span class="dv">31</span>)</code></pre></div>
<p>The allowed values of <code>i</code> are the same as we saw for slicing a vector in <a href="basics.html#slicing">2.1.7</a>. This is fairly unsafe on account of silent coercion, recycling and failure (when <code>i</code> is not a valid index of <code>x</code>). We will revisit how to modify vectors in data.tables in <a href="tables.html#dt-subassign">3.4</a>.</p>

<div class="rmd-caution">
<strong>Hard-to-find documentation.</strong> For documentation on slicing and extracting, type <code>?`[`</code>. Even though there is a <code>]</code> for every <code>[</code>, it is the opening bracket that is the function’s actual name, which will come back in <a href="basics.html#lapply">2.4.3</a>. For documentation on sub-assignment, type <code>?`[&lt;-`</code>.
</div>
<p></p>
<p>caution – silent extension of vector when assigning at a new index</p>
<p>empty index means the whole thing</p>
</div>
<div id="assigning-to-a-list-element" class="section level3">
<h3><span class="header-section-number">2.1.10</span> Assigning to a list element</h3>
<p>One can similarly assign to a single element of a list with <code>x[[i]] &lt;- y</code>. If an existing element is overwritten, no warning is given.</p>
</div>
<div id="initializing" class="section level3">
<h3><span class="header-section-number">2.1.11</span> Initializing</h3>
<p>In R, it bad practice to dynamically grow objects, like <code>x = 1</code>, <code>x = c(x,2)</code>, …, <code>x = c(x,n)</code>. Instead, create the vector with its final length first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">vector</span>(<span class="dt">length =</span> <span class="dv">5</span>, <span class="dt">mode =</span> <span class="st">&quot;list&quot;</span>)
x =<span class="st"> </span><span class="kw">character</span>(<span class="dt">length =</span> <span class="dv">5</span>)
x =<span class="st"> </span><span class="kw">logical</span>(<span class="dt">length =</span> <span class="dv">5</span>)
x =<span class="st"> </span><span class="kw">numeric</span>(<span class="dt">length =</span> <span class="dv">5</span>)
x =<span class="st"> </span><span class="kw">integer</span>(<span class="dt">length =</span> <span class="dv">5</span>)</code></pre></div>
<p>From there, we can subassign iteratively if necessary: <code>x[1] &lt;- &quot;A&quot;</code>, <code>x[2] &lt;- &quot;B&quot;</code>, and so on.</p>
<div id="rep" class="section level4">
<h4><span class="header-section-number">2.1.11.1</span> Repeating values</h4>
<p>It’s also common to initialize a vector with a particular value using <code>rep</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rep</span>(<span class="dv">3</span>, <span class="dv">10</span>)</code></pre></div>
<pre><code>#  [1] 3 3 3 3 3 3 3 3 3 3</code></pre>
<p><code>rep(x, n)</code> extends nicely to the case where <code>x</code> is a vector. It does this in a few different configurations, as documented at <code>?rep</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="dv">5</span>)</code></pre></div>
<pre><code>#  [1] 3 4 3 4 3 4 3 4 3 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="dt">each =</span> <span class="dv">5</span>)</code></pre></div>
<pre><code>#  [1] 3 3 3 3 3 4 4 4 4 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="dt">length.out =</span> <span class="dv">5</span>)</code></pre></div>
<pre><code># [1] 3 4 3 4 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))</code></pre></div>
<pre><code># [1] 3 3 3 4 4 4 4</code></pre>
</div>
<div id="integer-sequences" class="section level4">
<h4><span class="header-section-number">2.1.11.2</span> Integer sequences</h4>
<p>Use a single colon to build a sequence of integers:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">3</span>:<span class="dv">5</span></code></pre></div>
<pre><code># [1] 3 4 5</code></pre>

<div class="rmd-caution">
<p><strong>Use parentheses liberally.</strong></p>
<ul>
<li><code>n:n+10</code> does <em>not</em> run from <code>n</code> to <code>n+10</code>. Parentheses are needed: <code>n:(n+10)</code>.</li>
<li><code>-1:3+10</code> and <code>10-1:3</code> do not give the same results. Again, parentheses are needed to clarify which result is wanted.</li>
</ul>
See <a href="basics.html#order-ops">2.3.5</a> for more details.
</div>
<p></p>
<p>If we are running <code>1..n</code> where <code>n</code> is a nonnegative integer variable, it is safer and more efficient to use <code>seq_len</code> than <code>1:n</code>. It is safer in the sense that, if <code>n</code> is zero, <code>seq_len(n)</code> gives the correct result of a zero-length vector, while <code>1:0</code> gives <code>c(1L, 0L)</code>.</p>
<p>If we are running <code>1...length(x)</code> alongside some vector <code>x</code>, then <code>seq_along</code> is the right tool:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>)
<span class="kw">seq_along</span>(x)</code></pre></div>
<pre><code># [1] 1 2 3</code></pre>

<div class="rmd-details">
<strong>R function names.</strong> It is not worth trying to make sense of R’s naming conventions. Presumably thanks to historical accidents (some involving R’s ancestor, S), we have names like <code>seq.int</code>, <code>seq_along</code>, <code>setNames</code>, <code>Sys.time</code>, <code>Sys.Date</code>, <code>sys.status</code> and <code>system.time</code>. All names are case-sensitive.
</div>
<p></p>
</div>
<div id="seq-fancy" class="section level4">
<h4><span class="header-section-number">2.1.11.3</span> Fancy sequences</h4>
<p>From here, the variety of options starts to resemble what we saw for the <code>rep</code> function in <a href="basics.html#rep">2.1.11.1</a>.</p>
<p>The function <code>seq.int</code> extends the colon operator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq.int</span>(<span class="dv">5</span>, <span class="dv">10</span>)</code></pre></div>
<pre><code># [1]  5  6  7  8  9 10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq.int</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dt">by =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code># [1] 5 7 9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq.int</span>(<span class="dv">5</span>, <span class="dt">by =</span> <span class="dv">3</span>, <span class="dt">length.out =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code># [1]  5  8 11</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq.int</span>(<span class="dt">to =</span> <span class="dv">100</span>, <span class="dt">by =</span> -<span class="dv">11</span>, <span class="dt">length.out =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code># [1] 122 111 100</code></pre>
<p>The <code>seq</code> function extends further by allowing for non-integer values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dt">by=</span>.<span class="dv">5</span>)</code></pre></div>
<pre><code>#  [1]  5.0  5.5  6.0  6.5  7.0  7.5  8.0  8.5  9.0  9.5 10.0</code></pre>
<p>Other vector classes have their own <code>seq</code> methods. For example, <code>seq.Date</code> will allow for a sequence of dates.</p>
</div>
</div>
<div id="factors" class="section level3">
<h3><span class="header-section-number">2.1.12</span> Factors</h3>
<p>As with missing values, a lot of thought was put into the treatment of categorical data in R, captured by the <code>factor</code> data type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;New York&quot;</span>, <span class="st">&quot;Tokyo&quot;</span>, <span class="st">&quot;Mumbai&quot;</span>, <span class="st">&quot;Tokyo&quot;</span>))</code></pre></div>
<pre><code># [1] New York Tokyo    Mumbai   Tokyo   
# Levels: Mumbai New York Tokyo</code></pre>
<p>Factors often have no sense of ordering (like “Tokyo” naturally coming before “Bombay”), but one can be added if appropriate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Worst&quot;</span>, <span class="st">&quot;Best&quot;</span>, <span class="st">&quot;Not Bad&quot;</span>, <span class="st">&quot;Worst&quot;</span>), <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Worst&quot;</span>, <span class="st">&quot;Not Bad&quot;</span>, <span class="st">&quot;Best&quot;</span>), <span class="dt">ordered =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code># [1] Worst   Best    Not Bad Worst  
# Levels: Worst &lt; Not Bad &lt; Best</code></pre>
<p>To see whether a factor has an order, use <code>is.ordered</code>. Details on manipulating factors can be found at <code>?factor</code> and linked pages.</p>
</div>
<div id="sort-rank-order" class="section level3">
<h3><span class="header-section-number">2.1.13</span> Sorting, rank, order</h3>
<p>There are three key functions here:</p>
<ul>
<li><code>sort(x)</code> will sort the vector.</li>
<li><code>rank(x)</code> tells where each element of <code>x</code> is in the pecking order.</li>
<li><code>order(x)</code> is rarely useful on its own, but <code>y[order(x, z)]</code> will sort <code>y</code> by <code>x</code> and <code>z</code>.</li>
</ul>
<p>Be careful not to use these functions on an unordered factor, where they will make no sense but run without warning.</p>
<p>The <code>frank()</code> function (yes, really) from the data.table package is also useful, for its “dense” rank tie-breaking rule.</p>
</div>
<div id="testing-membership" class="section level3">
<h3><span class="header-section-number">2.1.14</span> Testing membership</h3>
<p>– move this to Syntax – too early for the reader to learn elementwise stuff</p>
<p>Besides comparisons, <code>x == y</code>, we can test membership like <code>x %in% y</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="ot">NA</span>) %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</code></pre></div>
<pre><code># [1]  TRUE FALSE FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="st">&quot;A&quot;</span> %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>)</code></pre></div>
<pre><code># [1] TRUE</code></pre>
<p>We get one true/false value for each element on the left-hand side. Duplicate values on the right-hand side are ignored. That is, the right-hand side is treated like a <em>set</em>.</p>
<p>Unlike <code>==</code>, here we always get a true/false result, even when missing values are present.</p>
</div>
<div id="exercises" class="section level3">
<h3><span class="header-section-number">2.1.15</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>What is the class of <code>c(TRUE, 1)</code>?</li>
<li>What is the length of <code>list(1, c(2,3))</code>?</li>
<li>If I run <code>x = c(&quot;a&quot;,&quot;b&quot;)</code> and then <code>x[c(2,1)] = c(&quot;c&quot;,&quot;d&quot;)</code>, what is the value of <code>x[1]</code>?</li>
<li>Write the command to summon documenation for for the assignment procedure used in <code>L$X &lt;- list(3)</code>.</li>
</ol>
</div>
</div>
<div id="matrix-array" class="section level2">
<h2><span class="header-section-number">2.2</span> Matrices and arrays</h2>
<p>The <code>matrix</code> function is used for construction:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># example data</span>
v =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">matrix</span>(v, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>#      [,1] [,2]
# [1,]    1    3
# [2,]    2    4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">matrix</span>(v, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>#      [,1] [,2]
# [1,]    1    2
# [2,]    3    4</code></pre>
<p>By default, the matrix is built with column-major order; but <code>byrow = TRUE</code> will read as row-major.</p>
<p>The dimensions of a matrix can be extracted with the <code>dim</code> function or <code>nrow</code> and <code>ncol</code>.</p>
<p>All elements of a matrix must have the same class, just like a vector. So we can have a “character matrix”, a “numeric matrix”, etc.</p>

<div class="rmd-details">
<strong>Vectors with attributes.</strong> In fact, a matrix <em>is</em> a vector, just augmented by the <code>dim</code> attribute. As mentioned at the top, all data in R is stored in vectors; and as mentioned in <a href="basics.html#classes">2.1.2</a>, most classes are built on top of vectors. One wrinkle is that <code>is.vector</code> is false for matrices. However, this makes sense in light of the doc, <code>?is.vector</code>.
</div>
<p></p>
<p>caution – column-major, not sure if this needs a box</p>
<div id="building-matrices" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Building matrices</h3>
<p>Matrices can also be built from vectors with <code>cbind</code> and <code>rbind</code> (for “binding” columns or rows):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</code></pre></div>
<pre><code>#      [,1] [,2]
# [1,]    1    1
# [2,]    2    2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))</code></pre></div>
<pre><code>#      [,1] [,2] [,3]
# [1,]    1    2    3
# [2,]    1    2    3</code></pre>
<p>These functions can also build matrices from other matrices.</p>
<p><code>diag(n)</code> will make an identity matrix of size <code>n</code>; and <code>diag(v)</code> will make a diagonal matrix with <code>v</code> on the diagonal.</p>
</div>
<div id="named-rows-and-columns" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Named rows and columns</h3>
<p>Rows and columns can be named:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>)))</code></pre></div>
<pre><code>#   x y
# a 1 3
# b 2 4</code></pre>
</div>
<div id="slicing-matrix" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Slicing to a submatrix</h3>
<p>To take a matrix slice, selecting a submatrix, use <code>m[i,j]</code> as in math:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># example data</span>
m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>)))</code></pre></div>
<pre><code>#   x y z
# a 1 3 5
# b 2 4 6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m[<span class="dv">1</span>, <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), drop =<span class="st"> </span><span class="ot">FALSE</span>]</code></pre></div>
<pre><code>#   x y
# a 1 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m[<span class="st">&quot;a&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>), drop =<span class="st"> </span><span class="ot">FALSE</span>]</code></pre></div>
<pre><code>#   x y
# a 1 3</code></pre>
<p>We can get fancy with indices, in all the ways described in <a href="basics.html#slicing">2.1.7</a>. It is often covenient to leave one index blank, which means “select all”; try <code>m[, 2, drop = FALSE]</code>.</p>

<div class="rmd-caution">
<strong>Dropped dimensions.</strong> The <code>drop = FALSE</code> option is necessary to ensure that the result is a submatrix. R’s default behavior is to “drop” dimensions when it can, which makes for unpredictable output.
</div>
<p></p>
<p>Implicitly, matrices are regarded as having observations as rows and variables as columns. As a result, <code>head</code> and <code>tail</code> will return rows from the top and bottom of a matrix, respectively.</p>
</div>
<div id="matrix-extract" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Extracting from matrices</h3>
<p>Since matrices <em>are</em> vectors, we can extract a vector of values in the same way:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># example data</span>
m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>), <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>)))</code></pre></div>
<pre><code>#   x y z
# a 1 3 5
# b 2 4 6</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m[<span class="dv">3</span>]</code></pre></div>
<pre><code># [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)]</code></pre></div>
<pre><code># [1] 2 3</code></pre>
<p>Matrices also allow extraction like <code>X[Y]</code>, where <code>Y</code> is a two column “index matrix”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">im =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)
m[im]</code></pre></div>
<pre><code># [1] 1 4</code></pre>
<p>The first column of <code>im</code> corresponds to rows, and the second to columns. Elements are extracted in the order they are listed in <code>im</code>.</p>
<p><code>drop = TRUE</code> can be used to select a column or row, like <code>m[, 2]</code> (where <code>drop = TRUE</code> is the default) or a single element, like <code>m[1, 2]</code> or <code>m[&quot;a&quot;, &quot;y&quot;]</code>.</p>
<p>Finally, <code>diag(m)</code> will extract the diagonal from a matrix; while <code>upper.tri</code> and <code>lower.tri</code> extract those parts (in column-major order).</p>
</div>
<div id="subassigning-to-matrices" class="section level3">
<h3><span class="header-section-number">2.2.5</span> Subassigning to matrices</h3>
<p>Assign to elements of a matrix in one of a few ways:</p>
<ul>
<li><code>X[i,j] = z</code> where <code>i</code> and <code>j</code> are rows and columns, respectively</li>
<li><code>X[i] = z</code> with <code>i</code> being an index vector</li>
<li><code>X[im] = z</code> with <code>im</code> being an index matrix</li>
</ul>
<p>In all cases, <code>z</code> is a vector or matrix of values.</p>
</div>
<div id="arrays" class="section level3">
<h3><span class="header-section-number">2.2.6</span> Arrays</h3>
<p>Arrays are the same as matrices, just in higher dimensions. For example, a three-dimensional array will have a <code>dim</code> attribute of length three and have slicing syntax like <code>a[i,j,k]</code>. They can be constructed like <code>a = array(v, dim = c(1,2,2))</code>.</p>
</div>
</div>
<div id="syntax" class="section level2">
<h2><span class="header-section-number">2.3</span> Syntax</h2>
<div id="assigning-to-attributes" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Assigning to attributes</h3>
<p>There are convenience functions for modifying object attributes, with syntax like <code>names(x) &lt;- y</code> or <code>names(x) = y</code>. A few are for…</p>
<ul>
<li>vector element names, <code>?`names&lt;-`</code></li>
<li>vector class, <code>?`class&lt;-`</code></li>
<li>vector length, <code>?`length&lt;-`</code></li>
<li>matrix or array dimensions, <code>?`dim&lt;-`</code></li>
<li>matrix or array names, <code>?`dimnames&lt;-`</code></li>
</ul>
<p>These are rarely needed and can be confusing for obvious reasons.</p>
<p>… also, link to data.table mod by ref</p>
<p>… insert a section on vectorization / elementwise operators, mention interaction with recycling oh, that section already exists, well, move it up here or carefully avoid elementwise stuff until after that section…</p>
</div>
<div id="arithmetic" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Arithmetic</h3>
<p>The full set of arithmetic operators is documented at <code>?Arithmetic</code>. The integer division and modulo operators look like <code>%/%</code> and <code>%%</code>, but otherwise, everything is standard. Other basic functions include <code>round</code>, <code>floor</code>, <code>ceiling</code>, <code>min</code>, <code>max</code>, <code>log</code>, <code>exp</code>, <code>sqrt</code>.</p>
<p>Essentially all computations involving missing values will return a missing value. One exception is <code>NA^0</code> since no matter what number the true value is, this expression will evaluate to <code>1</code>. (Recall that a missing value means “there is some true value, but we don’t know what it is.”) The <code>min</code> and <code>max</code> functions can ignore missing values, as noted in their docs. <a href="tables.html#explore-onevar">3.7.4</a> and <a href="tables.html#explore-vars">3.7.5</a> cover other summarizing functions, most of which similarly offer to ignore <code>NA</code>s.</p>
<p>As in <a href="http://floating-point-gui.de/">any other programming environment</a>, floating point arithmetic in R can trip up calculations. For example, try <code>.1 + .05 - .15 == 0</code>.</p>

<div class="rmd-caution">
<strong>Arithmetic with logical values.</strong> Particularly when exploring data, we often want to tally observations meeting some condition. To do this in R, we can treat true/false like 1/0: <code>is_gt = c(1,5,2) &gt; c(1,2,3); sum(is_gt)</code>.
</div>
<p></p>
</div>
<div id="logical-operators" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Logical operators</h3>
<p>The self-explanatory symbols <code>!</code>, <code>&amp;</code> and <code>|</code> are used to construct compound logical tests. The treatment of missing values is intuitive:</p>
<ul>
<li><code>NA | TRUE</code> is true, since no matter what the missing value is (<code>TRUE</code> or <code>FALSE</code>), the compound statement must be true.</li>
<li><code>NA &amp; TRUE</code> is <code>NA</code>, since we need to know the missing value to determine the truth or falsehood of the compound statement.</li>
<li>And so on.</li>
</ul>

<div class="rmd-caution">
<strong>Logic with numeric values.</strong> Numbers are treated as <code>FALSE</code> when zero and <code>TRUE</code> otherwise. This allows us to use <code>length(x)</code> as a test instead of <code>length(x) &gt; 0</code>.
</div>
<p></p>
<p>A couple additional symbols, <code>||</code> and <code>&amp;&amp;</code>, do short circuiting and will be explained in <a href="basics.html#vectorization">2.3.6</a>.</p>
</div>
<div id="matrix-algebra" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Matrix algebra</h3>
<ul>
<li><em>Transpose</em> <code>t(X)</code></li>
<li><em>Multiply</em> <code>X %*% Y</code></li>
</ul>
<p>These functions treat a vanilla vector as a column vector.</p>
<p>Remember that the undecorated <code>*</code> will always work elementwise (ref above) and silently recycle values.</p>
</div>
<div id="order-ops" class="section level3">
<h3><span class="header-section-number">2.3.5</span> Order of operations</h3>
<p>The order of operations is listed in <code>?Syntax</code>. In addition to the operators listed, <code>**</code> is an alias for <code>^</code>. The <code>%any%</code> listed there refers to a broad class of “infix” binary operators:</p>
<ul>
<li><code>%/%</code> and <code>%%</code> for integer division and modulo;</li>
<li><code>%in%</code> to test membership;</li>
<li><code>%*%</code> for matrix multiplication; and</li>
<li>any custom infix operators defined by the user or in loaded packages.</li>
</ul>
<p>Even knowing the order of operations, I recommend using parentheses liberally, particularly in <code>!(...)</code> statements.</p>
</div>
<div id="vectorization" class="section level3">
<h3><span class="header-section-number">2.3.6</span> Elementwise operations</h3>
<p>Most operations in R are performed elementwise:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)
y =<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)
x /<span class="st"> </span>y</code></pre></div>
<pre><code># [1] 0.5000000 0.6666667</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x ^<span class="st"> </span>y</code></pre></div>
<pre><code># [1] 1 8</code></pre>
<p>We call functions with this behavior “vectorized.” R is a lot faster when operations are performed elementwise rather than in a loop, so there’s a common mantra to “vectorize your code,” especially when doing arithmetic. The idea is similar to translating a statistical model into matrix algebra.</p>

<div class="rmd-caution">
<strong>Recycling, again.</strong> As we saw in <a href="basics.html#slicing">2.1.7</a>, recycling kicks for any vectorized function. So we have <code>c(-2,2) ^ c(1,2,3,4)</code> working, with no warning given. Fortunately, there is a warning if the recycling is imperfect, like <code>c(-2,2) ^ c(1,2,3)</code>.
</div>
<p></p>
<p>A couple of notably non-vectorized functions are <code>&amp;&amp;</code> and <code>||</code>. These will (silently) only look at the first element on each side; and if the result can be determined using the left-hand side, for example in <code>FALSE &amp;&amp; x</code>, then the right-hand side will not be evaluated. These are useful mostly for improving efficiency on the margins.</p>
</div>
</div>
<div id="functions" class="section level2">
<h2><span class="header-section-number">2.4</span> Functions</h2>
<p>Functions in R all map input to output. In the documentation for a function, the input is covered in the Arguments section, while the output is in the Value section.</p>
<div id="community-made-functions" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Community-made functions</h3>
<div id="exploring-packages" class="section level4">
<h4><span class="header-section-number">2.4.1.1</span> Exploring packages</h4>
<p>R has a variety of packages specialized by task and area of research. The <a href="https://cran.r-project.org/web/views/">Task Views</a> on the web are a good way to browse available packages on CRAN, the Comprehensive R Archive Network.</p>
<p>Besides adding additional functions, many packages add new classes, for example for time series data.</p>
</div>
<div id="installing-packages" class="section level4">
<h4><span class="header-section-number">2.4.1.2</span> Installing packages</h4>
<p>It is best to install packages from CRAN, rather than elsewhere. Packages submitted to CRAN (i) have to pass some vetting procedures defined by the developers of R and and (ii) are typically used much more broadly than those not on CRAN, improving exposure of bugs.</p>
<p>To install a package from CRAN, use <code>install.packages</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;fortunes&quot;</span>)</code></pre></div>
<p>The first time this is run during an R session, a prompt will pop up, asking which mirror to download from.</p>
</div>
<div id="namespaces" class="section level4">
<h4><span class="header-section-number">2.4.1.3</span> Using functions from packages</h4>
<p>After installing a package, a direct attempt at using its functions will fail:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fortune</span>(<span class="dv">111</span>)</code></pre></div>
<pre><code># Error in eval(expr, envir, enclos): could not find function &quot;fortune&quot;</code></pre>
<p>Instead:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fortunes::<span class="kw">fortune</span>(<span class="dv">111</span>)</code></pre></div>
<pre><code># 
# You can&#39;t expect statistical procedures to rescue you from poor data.
#    -- Berton Gunter (on dealing with missing values in a cluster analysis)
#       R-help (April 2005)</code></pre>
<p>This code works because it indicates the “namespace” that the function comes from. See <code>?`::`</code>.</p>
<p>Another way to use functions from a package is to attach it with <code>library</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fortunes)
<span class="kw">fortune</span>(<span class="dv">347</span>)</code></pre></div>
<pre><code># 
# This is a bit like asking how should I tweak my sailboat so I can explore the ocean floor.
#    -- Roger Koenker (in response to a question about tweaking the quantreg package to
#       handle probit and heckit models)
#       R-help (May 2013)</code></pre>
<p>This adds all of the package’s functions and other objects to the search path, so we can write <code>fortune(111)</code> instead of the more verbose <code>fortunes::fortune(111)</code>. The downside to attaching a package is the risk of “namespace conflicts”:</p>
<ul>
<li>If the attached package has an object with the same name as something defined by the user, that object won’t enter the global namespace.</li>
<li>If two attached packages contain objects with the same name, the last-attached object gets precedence for entry into the global namespace.</li>
<li>Some packages will elbow their way past built-in base functions when attached, with a warning. When this happens, it should probably be taken as a red flag.</li>
</ul>
<p>Fortunately, in all these cases, R will print a message about the conflicting names.</p>
<p>To remove a package from the namespace, there’s <code>detach</code>, but I always just restart my R session instead.</p>
</div>
<div id="reading-package-docs" class="section level4">
<h4><span class="header-section-number">2.4.1.4</span> Reading package docs</h4>
<p>To read the doc for a function in a package, just write the full path, like <code>?fortunes::fortune</code>. To see a listing of functions provided by a package, use <code>help(package=&quot;fortunes&quot;)</code> or click “Index” at the bottom of the help page for any function in the package.</p>
</div>
<div id="updating-packages" class="section level4">
<h4><span class="header-section-number">2.4.1.5</span> Updating packages</h4>
<p>To update a package, just install it again:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;fortunes&quot;</span>)</code></pre></div>
<p>If a package is loaded (or attached), it cannot be updated, so close all R sessions where the package is loaded before updating it.</p>
<p>type sessionInfo() to view packages and other details about the r session</p>

<div class="rmd-details">
<strong>Managing packages.</strong> Use <code>installed.packages</code> to view dependencies and version numbers. Some other tools, <a href="https://github.com/rocker-org/rocker">rocker</a> and <a href="https://github.com/eddelbuettel/drat">drat</a>, look promising.
</div>
<p></p>

<div class="rmd-caution">
<strong>My opinion on trusting packages.</strong> If you don’t understand a package’s docs, don’t use it for anything serious. If the version number of the package is below 1.0, be ready to keep track of its development (since most package developers follow a pattern like <a href="http://r-pkgs.had.co.nz/release.html">Hadley Wickham’s</a>). Packages for input, output or graphing are fragile in any language, so isolate the code that depends on them as much as possible.
</div>
<p></p>
</div>
</div>
<div id="passing-arguments" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Passing arguments</h3>
<p>Compare the documentation <code>?vector</code> against usage in <a href="basics.html#initializing">2.1.11</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x =<span class="st"> </span><span class="kw">vector</span>(<span class="dt">length =</span> <span class="dv">5</span>, <span class="dt">mode =</span> <span class="st">&quot;list&quot;</span>)</code></pre></div>
<p>The arguments are being passed out-of-order, but this still works since the arguments are being passed by name. Passing arguments by the position, like <code>sort(x, TRUE)</code>, is a riskier proposition, since it is harder to get right initially and to interpret correctly later. Some data.table idioms for merging (<a href="tables.html#dt-joins">3.5</a>) involve passing arguments out-of-order.</p>
</div>
<div id="lapply" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Iterating over a list</h3>
<p>To apply the same function to every element of a list, use <code>lapply</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(<span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">7</span>,<span class="dv">9</span>), <span class="dv">0</span>), min)</code></pre></div>
<pre><code># [[1]]
# [1] 1
# 
# [[2]]
# [1] 2
# 
# [[3]]
# [1] 0</code></pre>
<p><code>lapply</code> is a very important tool in R and will come up again and again.</p>
</div>
<div id="function-writing" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Writing functions</h3>
<p>Like any other object, functions can be assigned with <code>&lt;-</code> or <code>=</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f =<span class="st"> </span>function(x) x^<span class="dv">2</span> +<span class="st"> </span><span class="dv">3</span>
<span class="kw">f</span>(<span class="dv">4</span>)</code></pre></div>
<p>Or steal a function from elsewhere:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f =<span class="st"> </span>fortunes::fortune</code></pre></div>
<p>For more complicated functions, use <code>{}</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f =<span class="st"> </span>function(x){
  x[<span class="dv">1</span>] =<span class="st"> </span><span class="dv">999</span>
  <span class="kw">return</span>(x)
}</code></pre></div>
<p><code>return</code> provides the return value. If a <code>return</code> command is reached before the end of a function, the rest of the code is not run. If no <code>return</code> command is given, the last value is used. To return multiple objects, combine them in a list and return it instead.</p>
<p>As with most other objects, R allows function names to be reused without warning, like</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">min =<span class="st"> </span>max</code></pre></div>
<p>Of course, this is usually a bad idea. To eliminate the custom function and revert to the base value, use <code>rm</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(min)</code></pre></div>
</div>
<div id="scoping" class="section level3">
<h3><span class="header-section-number">2.4.5</span> Scoping</h3>
<p>Consider a function that modifies its input:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># example function</span>
f =<span class="st"> </span>function(x){
  x[<span class="dv">1</span>] =<span class="st"> </span><span class="dv">999</span>
  <span class="kw">return</span>(x)
}</code></pre></div>
<p>Does modification inside the function alter the object passed to it?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)
<span class="kw">f</span>(z)</code></pre></div>
<pre><code># [1] 999   2   3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z</code></pre></div>
<pre><code># [1] 1 2 3</code></pre>
<p>We see that the modification does not carry over to the input itself. Usually, nothing created or altered inside a function does, meaning there are no <a href="http://programmers.stackexchange.com/q/40297/104607">side effects</a>. There are ways to write functions with side effects in base R (<code>&lt;&lt;-</code> and <code>assign</code>), but these are discouraged:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fortunes::<span class="kw">fortune</span>(<span class="st">&quot;the assign function&quot;</span>)</code></pre></div>
<pre><code># 
# The only people who should use the assign function are those who fully understand why you
# should never use the assign function.
#    -- Greg Snow
#       R-help (July 2009)</code></pre>
<p>The data.table package, introduced in <a href="tables.html#data-table">3.1.2</a>, has a different design philosophy regarding the mutability of objects by functions. <em>Its core functions almost all hinge on side effects</em>.</p>
</div>
<div id="lazy" class="section level3">
<h3><span class="header-section-number">2.4.6</span> Lazy evaluation</h3>
<p>Now let’s see how global variables called inside a function are handled.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y =<span class="st"> </span><span class="dv">1</span>
g =<span class="st"> </span>function(x) x +<span class="st"> </span>y
y =<span class="st"> </span><span class="dv">2</span>
<span class="kw">g</span>(<span class="dv">1</span>)</code></pre></div>
<pre><code># [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y =<span class="st"> </span><span class="dv">3</span>
<span class="kw">g</span>(<span class="dv">1</span>)</code></pre></div>
<pre><code># [1] 4</code></pre>
<p>So R only looks for <code>y</code> when it needs it and no sooner. This is called “lazy evaluation.” It has advantages, but can lead to mistakes. The next two sections (<a href="basics.html#function-environment">2.4.7</a> and <a href="basics.html#default-args">2.4.8</a>) cover ways of managing lazy evaluation.</p>
</div>
<div id="function-environment" class="section level3">
<h3><span class="header-section-number">2.4.7</span> Environment</h3>
<p>One can use <code>with</code> to bind a value to the function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g2 =<span class="st"> </span><span class="kw">with</span>(<span class="kw">list</span>(<span class="dt">y =</span> <span class="dv">4</span>), function(x) x +<span class="st"> </span>y)
y =<span class="st"> </span><span class="dv">1</span>
<span class="kw">g2</span>(<span class="dv">1</span>)</code></pre></div>
<pre><code># [1] 5</code></pre>
<p>Now, <code>y</code> is defined in the “environment” of the function. Environments are essentially lists, so the value can be extracted following syntax from <a href="basics.html#extract-list">2.1.8</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">environment</span>(g2)[[<span class="st">&quot;y&quot;</span>]]</code></pre></div>
<pre><code># [1] 4</code></pre>
</div>
<div id="default-args" class="section level3">
<h3><span class="header-section-number">2.4.8</span> Default arguments</h3>
<p>The documentation shows default values for arguments. After reading <code>?vector</code>, we know that <code>vector()</code> will return the same thing as <code>vector(mode = &quot;logical&quot;, length = 0)</code>.</p>
<p>When writing our own functions, we can also use default values. This offers another way of getting around the the issue in <a href="basics.html#lazy">2.4.6</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g3 =<span class="st"> </span>function(x, <span class="dt">y =</span> <span class="dv">4</span>) x +<span class="st"> </span>y
<span class="kw">g3</span>(<span class="dv">1</span>)</code></pre></div>
<pre><code># [1] 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">g3</span>(<span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">10</span>)</code></pre></div>
<pre><code># [1] 11</code></pre>
<p>Here, if we don’t pass <code>y</code> as an argument, the default value prevails. Thanks to lazy evaluation, we can even define default values <em>in terms of other arguments</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g4 =<span class="st"> </span>function(x, <span class="dt">y =</span> x) x +<span class="st"> </span>y
<span class="kw">g4</span>(<span class="dv">2</span>)</code></pre></div>
<pre><code># [1] 4</code></pre>
</div>
<div id="finding-a-function-by-name" class="section level3">
<h3><span class="header-section-number">2.4.9</span> Finding a function by name</h3>
<p>When I run into a function and don’t know what package it is from, besides searching online, I also sometimes use <code>help.search</code> or its <code>??</code> shortcut, like <code>??fortunes</code>. This will search all installed packages.</p>
</div>
<div id="inspect-fns" class="section level3">
<h3><span class="header-section-number">2.4.10</span> Inspecting function source code</h3>
<p>To inspect the R code behind a function, as with any other R object, just type its name:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nrow</code></pre></div>
<pre><code># function (x) 
# dim(x)[1L]
# &lt;bytecode: 0x000000000691cbc0&gt;
# &lt;environment: namespace:base&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">replace</code></pre></div>
<pre><code># function (x, list, values) 
# {
#     x[list] &lt;- values
#     x
# }
# &lt;bytecode: 0x00000000086e71e8&gt;
# &lt;environment: namespace:base&gt;</code></pre>
<p>The last two rows of these functions show (i) that they are compiled and (ii) the environment they were defined in.</p>
<p>Many functions are not “exported” for direct use. Nonetheless, their code may be found using <code>getAnywhere</code> or accessed directly using <code>:::</code> syntax:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getAnywhere</span>(head.default)
utils:::head.default</code></pre></div>
<p>Many such hidden functions are “methods”; see <code>?Methods</code>. There are also several functions that <em>should</em> be hidden, documented at <code>?.subset</code>, <code>?.getNamespace</code> and elsewhere. These docs always have prominent notes like:</p>
<blockquote>
<p>Not intended to be called directly, and only visible because of the special nature of the base namespace.</p>
</blockquote>
<p>Heed the docs and don’t use any hidden or should-be-hidden functions directly.</p>
<p>Other functions indicate that their core functionality is written elsewhere:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">max</code></pre></div>
<pre><code># function (..., na.rm = FALSE)  .Primitive(&quot;max&quot;)</code></pre>
<p>Often, the source code for base R functions is in C and is fairly readable even for the C-illiterate. Following <a href="http://stackoverflow.com/a/19226817">Joshua Ulrich’s instructions</a>:</p>
<ol style="list-style-type: decimal">
<li>Navigate to a copy of the source code.</li>
<li>Browse to <code>/src/main/names.c</code></li>
<li>Read the <code>c-entry</code> column for the function of interest.</li>
<li>Search the text of <code>/src/main/*.c</code> for it.</li>
</ol>
</div>
</div>
<div id="loops" class="section level2">
<h2><span class="header-section-number">2.5</span> Loops and control flow</h2>
<p>As in most programming languages, we have <code>for</code> loops, <code>if</code>/<code>else</code> blocks, and so on. Some quirks to note:</p>
<ul>
<li>Write <code>for (i in idx) ...</code> to iterate over the vector <code>idx</code>, even its duplicates.</li>
<li>Write <code>else if</code>, since there is no <code>elseif</code>, <code>elsif</code> or <code>elif</code>.</li>
<li>Use <code>next</code> to bust out of the current iteration of a loop.</li>
<li>Use <code>break</code> to bust out of the loop entirely.</li>
</ul>
<div id="for-loops" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Thinking about <code>for</code> loops</h3>
<p>Suppose we have this loop:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">idx =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)

x   =<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(idx))
for (i in idx){
  i2    =<span class="st"> </span>i^<span class="dv">2</span>
  x[i]  =<span class="st"> </span><span class="dv">2</span>*i2 -<span class="st"> </span><span class="dv">1</span>
}</code></pre></div>
<p>There are a couple problems here:</p>
<ul>
<li>We have to refer to <code>x</code> multiple times, requiring extra coding if we want to reuse this code elsewhere.</li>
<li>The global environment is polluted by <code>i</code> and <code>i2</code> in the end.</li>
<li>There is no need for an iterative approach, since each <code>x[i]</code> can be computed independently.</li>
</ul>
<p>A sibling to <code>lapply</code>, our tool for iterating over lists from <a href="basics.html#lapply">2.4.3</a>, can help:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">idx =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)
x =<span class="st"> </span><span class="kw">sapply</span>(idx, function(i){
  i2    =<span class="st"> </span>i^<span class="dv">2</span>
  <span class="kw">return</span>(<span class="dv">2</span>*i2 -<span class="st"> </span><span class="dv">1</span>)
})</code></pre></div>
<p>Of course, there is still one further problem:</p>
<ul>
<li>This task can be done with vectorized code!</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">idx =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)
i2  =<span class="st"> </span>idx^<span class="dv">2</span>
x   =<span class="st"> </span><span class="dv">2</span>*i2 -<span class="st"> </span><span class="dv">1</span></code></pre></div>
<p>Vectorized code and matrix algebra are much faster than a loop. Loops should be reserved for tasks that really must be performed iteratively. When speed becomes an issue for such tasks, it is time to learn <a href="http://www.rcpp.org/">the Rcpp family of packages</a>, which allow for coding in C++.</p>

<div class="rmd-caution">
<strong>Breaking an operation.</strong> When running a malfeasant loop (eating up too much memory or taking too long) in the R console, the operation can be broken by pressing <code>ESC</code>. This applies elsewhere in R as well, but I usually run into it with loops or one of the several functions documented at <code>?lapply</code>.
</div>
<p></p>
</div>
<div id="ifelse" class="section level3">
<h3><span class="header-section-number">2.5.2</span> <code>if</code>/<code>else</code> elementwise</h3>

<div class="rmd-caution">
<strong>Dummy variables.</strong> First, if tempted to do <code>x = if (cond) 1 else 0</code>, don’t. As mentioned in <a href="basics.html#arithmetic">2.3.2</a>, the logical variable <code>cond</code> itself is perfect for storing this dummy variable.
</div>
<p></p>
<p>The base R tool for handling elementwise <code>if</code>/<code>else</code> rules is the function <code>ifelse</code>. However, it has some serious shortcomings. A better way, similar to the <code>gen</code>/<code>replace</code> pattern in Stata, is covered in <a href="tables.html#dt-ifelse">3.4.4</a>.</p>
</div>
</div>
<div id="data-frames" class="section level2">
<h2><span class="header-section-number">2.6</span> Data frames</h2>
<p><em>My recommendation is always to use a data.table (introduced in <a href="tables.html#dt-class">3.2</a>) instead of a data frame, so I’ve kept this section short.</em></p>
<p>Vectors and matrices are fine once we’re estimating a statistical model. However, we typically start with data consisting of many observations of multiple variables of varying types. To store data of different types, a vector of matrix won’t work; we need a list. R offers a special list structure, the data frame, for this common situation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># example data</span>
DF =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">x =</span> letters[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)], 
  <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), 
  <span class="dt">z =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) &gt;<span class="st"> </span><span class="dv">3</span>
)
DF</code></pre></div>
<pre><code>#   x y     z
# 1 a 1 FALSE
# 2 b 2 FALSE
# 3 c 3 FALSE
# 4 d 4  TRUE
# 5 e 5  TRUE</code></pre>
<p>Data frames are printed with observations on rows and variables on columns. In many ways, they behave like matrices: working with functions like <code>dim</code>, <code>ncol</code>, <code>nrow</code>, <code>head</code> and <code>tail</code>; using <code>DF[i, j]</code> syntax for slices; and even using <code>DF[im]</code> syntax for matrix indexing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF[<span class="dv">3</span>, ]</code></pre></div>
<pre><code>#   x y     z
# 3 c 3 FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF[, <span class="st">&quot;z&quot;</span>, drop=<span class="ot">FALSE</span>]</code></pre></div>
<pre><code>#       z
# 1 FALSE
# 2 FALSE
# 3 FALSE
# 4  TRUE
# 5  TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">im =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>) 
DF[im] <span class="co"># DON&#39;T DO THIS</span></code></pre></div>
<pre><code># [1] &quot;a&quot; &quot;2&quot;</code></pre>
<p>The last item above, <code>DF[im]</code> is nonsensical in two ways:</p>
<ul>
<li>First, all elements in the result are coerced to a single type.</li>
<li>Second, we are referring to variables by column number instead of name.</li>
</ul>
<p>Naturally, if the data already is entirely numeric and the remaining analytical tasks are all linear algebra, a matrix will be simpler and almost always computationally faster than a data frame.</p>
<div id="lapply-df" class="section level3">
<h3><span class="header-section-number">2.6.1</span> Iterating over columns</h3>
<p>It is useful to keep in mind that data frames are really lists of columns, not matrices. Because they are lists, we can iterate over columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lapply</span>(DF, function(x) x[<span class="dv">3</span>])</code></pre></div>
<pre><code># $x
# [1] c
# Levels: a b c d e
# 
# $y
# [1] 3
# 
# $z
# [1] FALSE</code></pre>

<div class="rmd-caution">
<strong>Manual coercion.</strong> We can also get the result of that <code>lapply</code> call by coercion to a list: <code>as.list(DF[3, ])</code>. The names of similar functions can be guessed: <code>as.matrix</code>, <code>as.data.frame</code>, <code>as.vector</code>, <code>as.logical</code>, <code>as.integer</code>, <code>as.numeric</code>, <code>as.character</code>, <code>as.factor</code>, and so on. There is <code>as(x, &quot;class_name&quot;)</code>, but I have found the latter to be finicky.
</div>
<p></p>
</div>
<div id="view" class="section level3">
<h3><span class="header-section-number">2.6.2</span> Inspection</h3>
<p>To browse a data frame in a separate window, use <code>View(DF)</code>.</p>
</div>
</div>
<div id="built-ins" class="section level2">
<h2><span class="header-section-number">2.7</span> Built-in constants</h2>
<p>R includes several handy constants, like <code>pi</code>, the alphabet (<code>?letters</code>), months (<code>?month.name</code>), days of the week (<code>?weekdays</code>) and US state names and abbreviations (<code>?state</code>). There is no need to worry about accidentally reusing any of these contants’ names for variables (though redefining <code>pi</code> might not be a great idea).</p>

<div class="rmd-caution">
<strong>Masking.</strong> Besides built-in constants, it is also possible to reuse names of variables and functions from base R. In general, this is harmless unless its going to make things confusing, like a <code>matrix</code> named “matrix.”
</div>
<p></p>
<p>On a related note, <code>?Reserved</code> lists all of R’s important built-ins that cannot be overwritten.</p>

</div>
</div>
<p style="text-align: center;">
<a href="index.html"><button class="btn btn-default">Previous</button></a>
<a href="tables.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
